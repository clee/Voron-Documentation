I"Ô<h1 id="fly-flyf407zg-klipper-firmware">FLY FLYF407ZG Klipper Firmware</h1>

<h3 id="required-items">Required Items</h3>

<ul>
  <li>Klipper must be installed onto the Raspberry Pi</li>
  <li>At least one microSD card needs to be available depending on number of controllers.</li>
</ul>

<h3 id="build-firmware-image">Build Firmware Image</h3>

<ul>
  <li>Login to the Raspberry Pi</li>
  <li>Run the following:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install make
cd ~/klipper
make menuconfig
</code></pre></div></div>

<p>In the menu structure there are a number of items to be selected.</p>

<ul>
  <li>Ensure that ‚ÄúEnable extra low-level configuration options‚Äù is selected</li>
  <li>Ensure that the micro-controller architecture is set to ‚ÄòSTMicroelectronics STM32‚Äô</li>
  <li>Ensure that the Processor model is set to ‚ÄúSTM32F407‚Äù</li>
  <li>Ensure that the Bootloader offet is set to ‚Äú32KiB bootloader‚Äù</li>
  <li>Ensure that Clock Reference is set to ‚Äú8 MHz crystal‚Äù</li>
  <li>Ensure that  ‚ÄúUse USB for communication (instead of serial)‚Äù is selected</li>
</ul>

<p><img src="./images/flyf407zg_klipper_menuconfig.png" alt="" /></p>

<p>Once the configuration is selected, select ‚ÄúExit‚Äù and ‚ÄúYes‚Äù if asked to save the configuration.</p>

<p>Run the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make clean
make
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">make</code> command, when completed, creates a firmware file <strong>klipper.bin</strong> that is store in the folder <code class="language-plaintext highlighter-rouge">/home/pi/klipper/out</code>.  This file need to be copied to the FLY board.  The easiest way to do this is to use a GUI like <a href="https://winscp.net/eng/download.php">WinSCP</a> on Windows or either <a href="https://cyberduck.io">Cyberduck</a> or scp (from terminal) on Mac to copy the file to your computer.</p>

<p><img src="./images/cyberduck_example.png" alt="" /></p>

<h3 id="load-firmware-image">Load Firmware Image</h3>

<p>Copy the <strong>klipper.bin</strong> to the desktop, then rename it to <strong>firmware.bin</strong></p>

<p><strong>Important:</strong> If the file is not renamed, the bootloader will not be updated properly.</p>

<p>Ensure that the FLY board is not powered, then remove the microSD card that is installed.</p>

<p>Connect the microSD card to the computer with the <strong>firmware.bin</strong> file.  Open the microSC card in the file browser.  There may be a file named ‚Äòfly.cur‚Äô, that file can be deleted or left alone, it will be overwritten later.</p>

<p>Copy the <strong>firmware.bin</strong> from the desktop onto the microSD card.  If problems are encountered transferring the file(s) to the microSD card, reformat the microSD card with a FAT32 filesystem and try again.</p>

<p>Replace the microSD card(s) into the FLY.  If more than one, it does not matter which card goes into which controller.</p>

<p>Turn on the power supply to power on the FLY board.  If named properly, the FLY will automatically update with the Klipper firmware.</p>

<p><strong>Important:</strong> If the FLY not powered with 12-24V, Klipper will be unable to communicate with the TMC drivers via UART and the FLY will automatically shut down.</p>

<h3 id="back-to-software-installation">Back to <a href="./index.md#klipper-octoprint-configuration">Software Installation</a></h3>
:ET